#!/usr/bin/env python

"""
sats

Frontend to the sats package.

"""

from quippy import Atoms
from quippy.potential import Potential, Minim

from sats.core.dynamics import molecular_dynamics
from sats.core.io import castep_write
from sats.configurations.sheet import sheet


fs_lattice_parameter = 3.18
fcc_lattice_parameter = 3.95
hcp_lattice_parameter = 2.79
species = 74

fs_potential = Potential('IP FS')
fs_potential.set_calc_args({'E_scale': 0.99519, 'r_scale': 0.99302})

lattice_parameter = fs_lattice_parameter
supercell = (4, 4, 4)

structure_2d = Atoms(sheet(species, fs_lattice_parameter, gamma=90,
                           supercell=supercell, orthorhombic=True))
# structure_2d.translate((0, 0, -structure_2d.get_center_of_mass()[2]))

structure_2d.name = "W_3.18_120_44"

castep_write(structure_2d, structure_2d.name, optimise=False, fix_lattice=False)

structure_2d.set_cutoff(fs_potential.cutoff() + 2.0)
structure_2d.set_calculator(fs_potential)

minimiser = Minim(structure_2d, relax_positions=True, relax_cell=True)
minimiser.run()

castep_write(structure_2d, "min" + structure_2d.name, optimise=False, fix_lattice=True)

temperature = int(5000)
# From 10.1007/BF01184339, thermal expansion of tungsten is small, but for
# different temperatures we can expand a bit:
# 3000 K V/V0 = 1.11;
# 5000 K V/V0 = 1.29
#
if temperature == 1000:
    structure_2d.set_lattice(structure_2d.lattice*1.003, scale_positions=True)
elif temperature == 3000:
    structure_2d.set_lattice(structure_2d.lattice*(1.11**(1.0/3)), scale_positions=True)
elif temperature == 5000:
    structure_2d.set_lattice(structure_2d.lattice*(1.29**(1.0/3)), scale_positions=True)

molecular_dynamics(structure_2d, fs_potential, temperature)
